LN_ProgrammableTimer.txt
30jan17 ndp
03mar17

Log Notes for Programmable Timer board

ref1: ATmega328P_datasheet.pdf - 48/88/168/328 datasheet
ref2: DN_ProgrammableTimer.txt

Support: Realterm COM terminal utility (or write a pySerial app)

Set up Atmel Studio 7.0 C/C++ project..\DemoBoards\ProgrammableTimer\ProgTimer
Use LCD_CMD_16100 board for code development until parts arive.
Copy useful files from 
	\LCD_ControlPanel\LCD_ControlPanelSlaveInC\LCD_SlaveInC
eeprom.c,.h - EEPROM driver (untested and needs to be updated)
io_led_button.c,.h - LED and button access (modify as needed)
lcd_hdm16216h_5.c,.h - LCD basic driver for debug display
Copy useful files from 
	\I2C_Slave_Boards\Bootloader\PortOrgAVR112\TWI_Master_7_0
serial.c,.h
sysTimer.c,.h
Add files to project and hack as needed to display Serial to LCD.
Set FUSE for CLOCK DIV8 to get 1MHz from internal RC.
Set FUSE for Int. RC Osc 8MHz; Start-up time PWRDWN/RESET: 8 CK/14CK + 65ms
MOD: sysTimer.c to use 1 MHz clock..ok..LEDs flash..save it.
31jan17
Set up time-of-day resources.
Copy over mod_stdio.c,.h for text formatting..mod to support direct LCD 
control..Copy over dev_display.c,.h for text formatting..remove mod_stdio..
try it..WOOT, display up!..
ADD: mod_comms.c,.h
mod_comms_service() - send text or get text..hmm, bug in lcd_hdm16216h_5.c ?
Device failure. Only get first 8 characters. No combination writes to second 
areas..blah..undo hacks..ok, serial out and in works..2nd area started working.
.hmm, still flakey..use 0-7 line 1 for display..save
2feb17 
L and and R commands using RAM and not writing to EEPROM.
MOD: mod_comms - add mod_comms_service() - check for input. Use switch(char) 
to eval command which should be first char..
ADD: mod_parse.c,.h - parse command string.
mod_parse(char* str) - NULL terminated string or 22 char max.
ADD: mod_eventList.c,.h - to manage Event List.
test..hmm, set to use 16x for baud..timing off it seems.
Using 4800. Good to 0.2%..seems to be working now..add 0x0A 0x0D to reply..
ok..save..get OK on good format, ? on bad..
03feb17
R command..read back 64 items from list..months are 0-11, days 1-31..add 
dev_bin2BCD..ok..add mod_eventList_get(index)..ok..all working..
R command returns events 30-35..' '=32, '!'=33, ... so
L 2017-09-23 12:34:56
 and 
L!2017-09-23 12:34:56
can be used to load event times..save
04feb17
Idea: Return unrecognized command with a ? 0A 0D..ok..
Play with WDT..try RESET mode first..ok..hmm, don't think WDT will be 
accurate enough..use Power-save Mode and Timer2 OV interrupt..
MOD: sysTimer.c - Add st_init_tmr2() and ISR() to update time..use 32.768 kHz 
external crystal for best results .. clk/1024 = 32 .. /256 = OV at 8 seconds..
blah..need pins 9 & 10 for ext osc..have to rewire LEDs..use /1024 and /244 to 
get to 249.86ms timeout..
MOD: sysTimer.c - add st_setLocalTime() and st_getLocalTime()..
TODO: Need a system service that checks time and stays awake until all services 
are completed.
test comm with sleep cycle active..ok..set up check comms every 8s for 1s then 
go back to sleep..ok..save it..
05feb17
Fixed LCD display..send line now available..improved sleep time sleep/awake 
ratio..2 sec awake per 8 sec sleep, 10 sec if comm activity..save.
06feb17
S comand to set local time..and T to get locatl time..ok..test..working..save.
07feb17
Beeper PWM..
ADD: mod.audio.c,.h - Use Timer1 PWM..Copy mod_audio.c,.h from 
	\Robotics\Animatronics\FaceBoard\faceSym\faceSym
and add to project..change pin defs for 328P..ok, once the right pins used..
MOD: mod_audio.c - add MA_TONE, MA_NOTE for interrupt to select servicing mode..
Table cycle is 16.6ms, 0.2514ms per step..so, a freq of 256 -> 1/16.6ms = ~60Hz
Ok, still need to fix-up frequencies, but working now..save
10feb17
Add special Timer1 config for 4-5kHz LOUD beep..4kHz louder..beeps on Awake..
save..
13feb17
MOD: mod_eventList.c,.h - Add bool mod_eventList_check()..ok..test..ok..save.
16feb16
First board build..no problems..code modified for final board. Develpoment 
code sections removed..bin2BCD() needed..add..ok..test..all seems to work..
save as ALPHA version..
17feb17
Built second board. Added diode. Seems to work. Changed Awake blink to 5ms to 
conserve battery. 3.3v FTDI with 3v battery using diode retains RAM..ok..save.
20feb17
Switch to external 32kHz xtal for Timer2
MOD: sysTimer.c::st_init_tmr2()
MOD: main.c ..remove 32 count..ok..oops..change local time inc to +8 on Timer2 
interrupt..ok..save.
26feb17
Seconds ending in 0 cause two beeps.
Seconds ending in 5 or 9 cause tune.
works..ok.
03mar17
Add user interface for Event.
ADD: mod_audio.c :: isPlaying().. ok..
MOD: main.c - Add UI process..
09mar17
Added 'C' command to enter Self Check mode.
10mar17
ADD: mod_epLog.c, .h
Store <tag> first, then one or two time_t values. <tag> will determine the number of 
time_t values.
Maintain an me_NextAdrs value to manage storage location.
void me_store(uint8_t tag, time_t event);
void me_store(uint8_t tag, time_t event1, time_t event2);		// Overload function.
11mar17
Added code for logging ACK, Snooze, and NoAction times..
Add log formatter..ok..













